<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pre-Factura</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: #f5f5f5;
        padding: 20px;
      }
      #app {
        max-width: 900px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        margin-bottom: 30px;
        font-size: 28px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      th {
        background: #249cf4;
        color: white;
        padding: 12px;
        text-align: left;
        font-weight: 600;
      }
      th:last-child {
        width: 60px;
      }
      td {
        padding: 10px;
        border-bottom: 1px solid #e0e0e0;
      }
      input[type="text"],
      input[type="number"] {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      input[type="number"] {
        text-align: right;
      }
      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s;
      }
      .btn-add {
        background: #249cf4;
        color: white;
        margin-bottom: 20px;
      }
      .btn-add:hover {
        background: #075280;
      }
      .btn-remove {
        background: #f44336;
        color: white;
        padding: 6px 12px;
        font-size: 12px;
      }
      .btn-remove:hover {
        background: #da190b;
      }
      .totals {
        margin-top: 30px;
        border-top: 2px solid #333;
        padding-top: 20px;
      }
      .total-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 12px;
        font-size: 16px;
      }
      .total-row.final {
        font-size: 20px;
        font-weight: bold;
        color: #249cf4;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px solid #249cf4;
      }
      .discount-input {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .discount-input input {
        width: 100px;
        text-align: right;
      }
      .tax-cell {
        color: #666;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div
        style="
          display: flex;
          align-items: center;
          gap: 15px;
          margin-bottom: 20px;
        "
      >
        <img
          src="./assets/images/logo.jpg"
          alt="Ortho Fracture"
          style="height: 50px; width: 50px"
        />
        <h1 style="margin-bottom: 0px">Pre-Factura</h1>
      </div>
      <table>
        <thead>
          <tr>
            <th style="width: 30%">Item</th>
            <th style="width: 15%; text-align: center">Cantidad</th>
            <th style="width: 15%; text-align: right">Precio</th>
            <th style="width: 15%; text-align: right">ISV (12%)</th>
            <th style="width: 15%; text-align: right">Total</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(item, index) in items" :key="item.id">
            <td>
              <input
                type="text"
                v-model="item.name"
                :placeholder="'Item ' + (index + 1)"
              />
            </td>
            <td>
              <input
                type="number"
                v-model.number="item.quantity"
                min="1"
                step="1"
                style="text-align: center"
              />
            </td>
            <td>
              <input
                type="number"
                v-model.number="item.price"
                min="0"
                step="0.01"
                placeholder="0.00"
              />
            </td>
            <td class="tax-cell" style="text-align: right">
              Lps. {{ calculateTax(item.price * item.quantity).toFixed(2) }}
            </td>
            <td style="text-align: right; font-weight: 600">
              Lps. {{ ((item.price * item.quantity) + calculateTax(item.price *
              item.quantity)).toFixed(2) }}
            </td>
            <td>
              <button
                class="btn btn-remove"
                @click="removeItem(index)"
                :disabled="items.length === 1"
              >
                âœ•
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <button class="btn btn-add" @click="addItem">+ Agregar Item</button>

      <div class="totals">
        <div class="total-row">
          <span>Subtotal:</span>
          <span>Lps. {{ subtotal.toFixed(2) }}</span>
        </div>
        <div class="total-row">
          <span>(-) Descuento:</span>
          <div class="discount-input">
            <input
              type="number"
              v-model.number="discountPercent"
              min="0"
              max="100"
              step="0.1"
            />
            <span>% = Lps. {{ discountAmount.toFixed(2) }}</span>
          </div>
        </div>
        <div
          class="total-row"
          style="
            font-weight: 600;
            border-top: 1px solid #ddd;
            padding-top: 12px;
            margin-top: 12px;
          "
        >
          <span>Subtotal Neto:</span>
          <span>Lps. {{ subtotalNeto.toFixed(2) }}</span>
        </div>
        <div class="total-row">
          <span>ISV (12%):</span>
          <span>Lps. {{ totalTax.toFixed(2) }}</span>
        </div>
        <div class="total-row final">
          <span>TOTAL A PAGAR:</span>
          <span>Lps. {{ finalTotal.toFixed(2) }}</span>
        </div>
      </div>
    </div>

    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            items: [{ id: 1, name: "", price: 0, quantity: 1 }],
            discountPercent: 0,
            taxRate: 0.12,
          };
        },
        computed: {
          subtotal() {
            return this.items.reduce(
              (sum, item) =>
                sum + (Number(item.price) || 0) * (Number(item.quantity) || 0),
              0
            );
          },
          discountAmount() {
            return this.subtotal * (this.discountPercent / 100);
          },
          subtotalNeto() {
            return this.subtotal - this.discountAmount;
          },
          totalTax() {
            return this.subtotalNeto * this.taxRate;
          },
          finalTotal() {
            return this.subtotalNeto + this.totalTax;
          },
        },
        methods: {
          addItem() {
            this.items.push({
              id: Date.now(),
              name: "",
              price: 0,
              quantity: 1,
            });
          },
          removeItem(index) {
            if (this.items.length > 1) {
              this.items.splice(index, 1);
            }
          },
          calculateTax(price) {
            return (Number(price) || 0) * this.taxRate;
          },
        },
      }).mount("#app");
    </script>
  </body>
</html>
