<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pre-Factura</title>
    <meta
      name="description"
      content="Calculadora de pre-factura con ISV (15%) para Honduras. Calcula automáticamente impuestos, descuentos y totales. Desarrollado por Jose Vega."
    />
    <meta
      name="keywords"
      content="factura, ISV, Honduras, calculadora, impuestos, pre-factura, SAR"
    />
    <meta name="author" content="Jose Vega" />
    <link rel="canonical" href="https://jose-vega.netlify.app/" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="Pre-Factura | Calculadora de Facturas con ISV"
    />
    <meta
      property="og:description"
      content="Calculadora de pre-factura con ISV para Honduras. Calcula automáticamente impuestos, descuentos y totales."
    />
    <meta property="og:url" content="https://jose-vega.netlify.app/" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary" />
    <meta
      name="twitter:title"
      content="Pre-Factura | Calculadora de Facturas con ISV"
    />
    <meta
      name="twitter:description"
      content="Calculadora de pre-factura con ISV (15%) para Honduras"
    />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.3.4/vue.global.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background: #f5f5f5;
        padding: 20px;
      }
      #app {
        max-width: 1000px;
        margin: 0 auto;
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      h1 {
        color: #333;
        margin-bottom: 30px;
        font-size: 28px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 20px;
      }
      th {
        background: #249cf4;
        color: white;
        padding: 12px;
        text-align: left;
        font-weight: 600;
      }
      th:last-child {
        width: 60px;
      }
      td {
        padding: 10px;
        border-bottom: 1px solid #e0e0e0;
      }
      input[type="text"],
      input[type="number"] {
        width: 100%;
        padding: 8px;
        border: 1px solid #ddd;
        border-radius: 4px;
        font-size: 14px;
      }
      input[type="number"] {
        text-align: right;
      }
      input[type="checkbox"] {
        width: 18px;
        height: 18px;
        cursor: pointer;
      }
      .checkbox-cell {
        text-align: center;
      }
      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 600;
        transition: all 0.3s;
      }
      .btn-add {
        background: #249cf4;
        color: white;
        margin-bottom: 20px;
      }
      .btn-add:hover {
        background: #075280;
      }
      .btn-remove {
        background: #f44336;
        color: white;
        padding: 6px 12px;
        font-size: 12px;
      }
      .btn-remove:hover {
        background: #da190b;
      }
      .totals {
        margin-top: 30px;
        border-top: 2px solid #333;
        padding-top: 20px;
      }
      .total-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 12px;
        font-size: 16px;
      }
      .total-row.final {
        font-size: 20px;
        font-weight: bold;
        color: #249cf4;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px solid #249cf4;
      }
      .discount-input {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .discount-input input {
        width: 100px;
        text-align: right;
      }
      .tax-cell {
        color: #666;
        font-style: italic;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <div
        style="
          display: flex;
          justify-content: space-between;
          align-items: center;
          margin-bottom: 30px;
        "
      >
        <div style="display: flex; align-items: center">
          <img
            src="./assets/images/logo.jpg"
            alt="OrthoFracture"
            style="height: 50px; margin-right: 15px; vertical-align: middle"
          />
          <h1 style="margin-bottom: 0">Pre-Factura</h1>
        </div>
        <button class="btn" @click="resetInvoice">Reinciar</button>
      </div>

      <table>
        <thead>
          <tr>
            <th style="width: 25%">Item</th>
            <th style="width: 12%; text-align: center">Cantidad</th>
            <th style="width: 15%; text-align: right">Precio</th>
            <th style="width: 10%; text-align: center">ISV?</th>
            <th style="width: 13%; text-align: right">ISV (15%)</th>
            <th style="width: 15%; text-align: right">Total</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="(item, index) in items" :key="item.id">
            <td>
              <input
                type="text"
                v-model="item.name"
                :placeholder="'Item ' + (index + 1)"
              />
            </td>
            <td>
              <input
                type="number"
                v-model.number="item.quantity"
                min="1"
                step="1"
                style="text-align: center"
              />
            </td>
            <td>
              <input
                type="number"
                v-model.number="item.price"
                min="0"
                step="0.01"
                placeholder="0.00"
              />
            </td>
            <td class="checkbox-cell">
              <input type="checkbox" v-model="item.taxable" />
            </td>
            <td class="tax-cell" style="text-align: right">
              Lps. {{ item.taxable ? calculateTax(item.price *
              item.quantity).toFixed(2) : '0.00' }}
            </td>
            <td style="text-align: right; font-weight: 600">
              Lps. {{ ((item.price * item.quantity) + (item.taxable ?
              calculateTax(item.price * item.quantity) : 0)).toFixed(2) }}
            </td>
            <td>
              <button
                class="btn btn-remove"
                @click="removeItem(index)"
                :disabled="items.length === 1"
              >
                ✕
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <button class="btn btn-add" @click="addItem">+ Agregar Item</button>

      <div class="totals">
        <div class="total-row">
          <span>Subtotal:</span>
          <span>Lps. {{ subtotal.toFixed(2) }}</span>
        </div>
        <div class="total-row">
          <span>(-) Descuento:</span>
          <div class="discount-input">
            <input
              type="number"
              v-model.number="discountPercent"
              min="0"
              max="100"
              step="0.1"
            />
            <span>% = Lps. {{ discountAmount.toFixed(2) }}</span>
          </div>
        </div>
        <div
          class="total-row"
          style="
            font-weight: 600;
            border-top: 1px solid #ddd;
            padding-top: 12px;
            margin-top: 12px;
          "
        >
          <span>Subtotal Neto:</span>
          <span>Lps. {{ subtotalNeto.toFixed(2) }}</span>
        </div>
        <div class="total-row">
          <span>ISV (15%):</span>
          <span>Lps. {{ totalTax.toFixed(2) }}</span>
        </div>
        <div class="total-row final">
          <span>TOTAL A PAGAR:</span>
          <span>Lps. {{ finalTotal.toFixed(2) }}</span>
        </div>
      </div>
    </div>

    <script>
      const { createApp } = Vue;

      createApp({
        data() {
          return {
            items: [{ id: 1, name: "", price: 0, quantity: 1, taxable: true }],
            discountPercent: 0,
            taxRate: 0.15,
          };
        },
        computed: {
          subtotal() {
            return this.items.reduce(
              (sum, item) =>
                sum + (Number(item.price) || 0) * (Number(item.quantity) || 0),
              0
            );
          },
          discountAmount() {
            return this.subtotal * (this.discountPercent / 100);
          },
          subtotalNeto() {
            return this.subtotal - this.discountAmount;
          },
          totalTax() {
            // Calculate tax only on taxable items, after discount proportionally
            const taxableSubtotal = this.items.reduce((sum, item) => {
              if (item.taxable) {
                return (
                  sum + (Number(item.price) || 0) * (Number(item.quantity) || 0)
                );
              }
              return sum;
            }, 0);

            // Apply discount proportionally to taxable items
            const taxableAfterDiscount =
              this.subtotal > 0
                ? taxableSubtotal * (this.subtotalNeto / this.subtotal)
                : 0;

            return taxableAfterDiscount * this.taxRate;
          },
          finalTotal() {
            return this.subtotalNeto + this.totalTax;
          },
        },
        methods: {
          addItem() {
            this.items.push({
              id: Date.now(),
              name: "",
              price: 0,
              quantity: 1,
              taxable: true,
            });
          },
          removeItem(index) {
            if (this.items.length > 1) {
              this.items.splice(index, 1);
            }
          },
          calculateTax(price) {
            return (Number(price) || 0) * this.taxRate;
          },
          resetInvoice() {
            this.items = [
              {
                id: Date.now(),
                name: "",
                price: 0,
                quantity: 1,
                taxable: true,
              },
            ];
            this.discountPercent = 0;
          },
        },
      }).mount("#app");
    </script>
  </body>
</html>
